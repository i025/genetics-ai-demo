<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIé—ä¼ ç—…å¾®è¯¾Demo</title>
    <link rel="stylesheet" href="style.css">
    <!-- å¼•å…¥ Coze Web SDKï¼Œè¿™æ˜¯å®ç°å¯¹è¯åŠŸèƒ½çš„æ ¸å¿ƒ -->
    <script src="https://cdn.coze.com/ob-platform/web-sdk/v1/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        /* åŸºç¡€æ ·å¼ï¼Œè®©é¡µé¢çœ‹èµ·æ¥æ›´è§„æ•´ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        body {
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, #4F46E5 0%, #7E69AB 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .main-content {
            display: flex;
            flex-wrap: wrap;
            min-height: 600px;
        }
        /* å·¦ä¾§å¾®è¯¾è®²è§£åŒº */
        .lesson-panel {
            flex: 1;
            min-width: 300px;
            padding: 30px;
            border-right: 1px solid #eee;
        }
        .lesson-panel h2 {
            color: #4F46E5;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        .concept-box {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #4F46E5;
        }
        .concept-box ul {
            margin-left: 20px;
            margin-top: 10px;
        }
        /* å³ä¾§AIå¯¹è¯åŒº */
        .ai-panel {
            flex: 1;
            min-width: 300px;
            padding: 30px;
            display: flex;
            flex-direction: column;
        }
        .ai-panel h2 {
            color: #10B981;
            margin-bottom: 20px;
        }
        /* Cozeå¯¹è¯å®¹å™¨ï¼Œå¿…é¡»æœ‰å›ºå®šçš„é«˜åº¦ */
        #coze-chat {
            flex: 1;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px 0 rgba(0,0,0,0.05);
        }
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
        }
        .chart-panel {
            margin-bottom: 25px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
        }
        .info-box {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #4F46E5;
            font-size: 0.95em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§¬ åŸºå› é—ä¼ ç—…AIå¾®è¯¾æ¼”ç¤º</h1>
            <p>æ¢ç´¢å¸¸æŸ“è‰²ä½“éšæ€§é—ä¼ çš„å¥¥ç§˜ | ä¸AIå¯¼å¸ˆäº’åŠ¨å­¦ä¹ </p>
        </header>

        <div class="main-content">
            <section class="lesson-panel">
                <h2>ğŸ“š æ ¸å¿ƒæ¦‚å¿µï¼šå¸¸æŸ“è‰²ä½“éšæ€§é—ä¼ </h2>
                <p>æœ¬å¾®è¯¾å°†å¸®åŠ©ä½ ç†è§£ä¸€ç±»é‡è¦çš„é—ä¼ ç—…ä¼ é€’è§„å¾‹ã€‚</p>
                
                <div class="chart-panel">
                    <h3>ğŸ§¬ é—ä¼ ç³»è°±å›¾æ¨¡æ‹Ÿ</h3>
                    <p>ç‚¹å‡»å›¾ä¸­çš„å®¶åº­æˆå‘˜ï¼ŒæŸ¥çœ‹å…¶é—ä¼ ä¿¡æ¯ï¼š</p>
                    <!-- å›¾è¡¨å°†åœ¨è¿™é‡Œæ¸²æŸ“ -->
                    <div id="familyTree" style="width: 100%; height: 280px; margin-top: 15px;"></div>
                    <!-- ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
                    <div id="memberInfo" class="info-box">
                        <p><strong>å½“å‰é€‰ä¸­ï¼š</strong> <span id="selectedName">æš‚æ— </span></p>
                        <p><strong>åŸºå› å‹ï¼š</strong> <span id="selectedGenotype">-</span></p>
                        <p><strong>è¯´æ˜ï¼š</strong> <span id="selectedDesc">è¯·ç‚¹å‡»ä¸Šæ–¹å›¾è°±ä¸­çš„æˆå‘˜</span></p>
                    </div>
                </div>

                <div class="concept-box">
                    <h3>æ ¸å¿ƒç‰¹ç‚¹</h3>
                    <ul>
                        <li><strong>åŸºå› ä½ç½®</strong>ï¼šè‡´ç—…åŸºå› ä½äº<strong>å¸¸æŸ“è‰²ä½“</strong>ï¼ˆéæ€§æŸ“è‰²ä½“ï¼‰ä¸Šã€‚</li>
                        <li><strong>å‘ç—…æ¡ä»¶</strong>ï¼šåªæœ‰å½“ä¸ªä½“çš„ä¸€å¯¹ç­‰ä½åŸºå› éƒ½æ˜¯<strong>éšæ€§è‡´ç—…åŸºå› ï¼ˆaaï¼‰</strong>æ—¶æ‰ä¼šæ‚£ç—…ã€‚</li>
                        <li><strong>å…³é”®è§’è‰²</strong>ï¼šæºå¸¦ä¸€ä¸ªéšæ€§è‡´ç—…åŸºå› çš„<strong>æ‚åˆå­ï¼ˆAaï¼‰</strong>ç§°ä¸º<strong>æºå¸¦è€…</strong>ï¼Œä»–ä»¬æœ¬èº«å¥åº·ï¼Œä½†å¯èƒ½å°†è‡´ç—…åŸºå› ä¼ ç»™åä»£ã€‚</li>
                    </ul>
                </div>

                <div class="concept-box">
                    <h3>ç»å…¸é—ä¼ è§„å¾‹</h3>
                    <p>å½“<strong>ä¸¤ä½æºå¸¦è€…ï¼ˆAaï¼‰</strong>ç»“å©šæ—¶ï¼Œåä»£çš„åŸºå› å‹æ¦‚ç‡åˆ†å¸ƒå¦‚ä¸‹ï¼š</p>
                    <ul>
                        <li><span style="color:#10B981;">å¥åº· (AA)</span>ï¼šæ¦‚ç‡ 25%</li>
                        <li><span style="color:#F59E0B;">å¥åº·æºå¸¦è€… (Aa)</span>ï¼šæ¦‚ç‡ 50%</li>
                        <li><span style="color:#EF4444;">æ‚£ç—… (aa)</span>ï¼šæ¦‚ç‡ 25%</li>
                    </ul>
                    <p style="margin-top:15px; font-style:italic;">ğŸ‘‰ è¿™å°±æ˜¯â€œçˆ¶æ¯å¥åº·ï¼Œå­©å­å´å¯èƒ½æ‚£ç—…â€çš„é—ä¼ å­¦åŸç†ã€‚</p>
                </div>

                <div class="concept-box">
                    <h3>å­¦ä¹ ç›®æ ‡</h3>
                    <p>ç†è§£ä¸Šè¿°è§„å¾‹åï¼Œä½ å¯ä»¥å°è¯•å‘å³ä¾§çš„AIå¯¼å¸ˆæé—®ï¼Œä¾‹å¦‚ï¼š</p>
                    <p>â€œå¦‚æœæˆ‘æ˜¯æºå¸¦è€…ï¼Œæˆ‘çš„å­©å­ä¸€å®šä¼šæ‚£ç—…å—ï¼Ÿâ€<br>
                    â€œè¿‘äº²ç»“å©šä¸ºä»€ä¹ˆä¼šæé«˜é—ä¼ ç—…é£é™©ï¼Ÿâ€</p>
                </div>
            </section>

            <section class="ai-panel">
                <h2>ğŸ¤– å¯¹è¯AIå¯¼å¸ˆ</h2>
                <p>æˆ‘æ˜¯ä½ çš„ä¸“å±AIç”Ÿç‰©è€å¸ˆâ€œåŸºå› åšå£«â€ã€‚å…³äºä¸Šé¢çš„æ¦‚å¿µï¼Œæœ‰ä»»ä½•ç–‘é—®éƒ½å¯ä»¥é—®æˆ‘ï¼š</p>
                <!-- Coze SDK å°†æŠŠèŠå¤©ç•Œé¢æ¸²æŸ“åœ¨è¿™ä¸ªdivä¸­ -->
                <div id="coze-chat"></div>
            </section>
        </div>

        <footer>
            <p>è®¡ç®—æœºè®¾è®¡å¤§èµ› Â· AIå¾®è¯¾ä¸æ•™å­¦è¾…åŠ©èµ›é“ Demo | æœ¬é¡µé¢ä»…ç”¨äºå­¦ä¹ æ¼”ç¤º</p>
        </footer>
    </div>

    <script>
    // ========== é…ç½®åŒºï¼šæ­¤å¤„å¿…é¡»ä¿®æ”¹ ==========
    // æ›¿æ¢ä¸ºä½ ä»ä¸Šä¸€æ­¥è·å–çš„å®Œæ•´èŠå¤©é¡µé¢URL
    const chatPageUrl = 'https://www.coze.cn/store/agent/7599549366093430836?bot_id=true';
    // ==========================================

    // è·å–èŠå¤©å®¹å™¨
    const chatContainer = document.getElementById('coze-chat');

    function loadChatFrame() {
        if (!chatContainer) {
            console.error('é”™è¯¯ï¼šæœªæ‰¾åˆ°èŠå¤©å®¹å™¨ #coze-chat');
            return;
        }

        if (!chatPageUrl || chatPageUrl.includes('...')) {
            chatContainer.innerHTML = `
                <div style="color: #EF4444; padding: 30px; text-align: center; background: #FEF2F2; border-radius: 8px;">
                    <p><strong>æ­¥éª¤æœªå®Œæˆ</strong></p>
                    <p>è¯·å…ˆè·å–ä½ çš„AIèŠå¤©é“¾æ¥ï¼Œç„¶åæ›´æ–° <code>chatPageUrl</code> å˜é‡ã€‚</p>
                    <p>æ“ä½œï¼šåœ¨Cozeå¹³å°ï¼Œå°†ä½ çš„Bot <strong>â€œå‘å¸ƒåˆ°ç½‘é¡µâ€</strong>ï¼Œå³å¯è·å¾—é“¾æ¥ã€‚</p>
                </div>`;
            return;
        }

        console.log('æ­£åœ¨åŠ è½½AIèŠå¤©é¡µé¢ï¼š', chatPageUrl);

        // ä½¿ç”¨iframeåµŒå…¥Cozeå®˜æ–¹èŠå¤©é¡µ
        const iframe = document.createElement('iframe');
        iframe.src = chatPageUrl;
        iframe.id = 'coze-chat-frame';

        // è®¾ç½®æ ·å¼ï¼šç¡®ä¿iframeæ— ç¼èå…¥
        iframe.style.cssText = `
            width: 100%;
            height: 100%;
            min-height: 500px;
            border: none;
            border-radius: 12px;
            display: block;
        `;

        // æ¸…ç©ºå®¹å™¨å¹¶åŠ è½½
        chatContainer.innerHTML = '';
        chatContainer.appendChild(iframe);

        // å¯é€‰ï¼šæ·»åŠ åŠ è½½çŠ¶æ€æç¤º
        const loadingMsg = document.createElement('p');
        loadingMsg.textContent = 'æ­£åœ¨åŠ è½½AIå¯¼å¸ˆ...';
        loadingMsg.style.cssText = 'text-align: center; color: #6B7280; padding: 20px;';
        chatContainer.appendChild(loadingMsg);

        iframe.onload = function() {
            console.log('âœ… AIèŠå¤©é¡µé¢åŠ è½½æˆåŠŸï¼');
            loadingMsg.remove();
        };

        iframe.onerror = function() {
            console.error('âŒ èŠå¤©é¡µé¢åŠ è½½å¤±è´¥');
            loadingMsg.textContent = 'åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥é“¾æ¥æˆ–ç½‘ç»œã€‚';
            loadingMsg.style.color = '#EF4444';
        };
    }

    // ========== äº¤äº’å¼é—ä¼ å›¾è°±ä»£ç  ==========
    document.addEventListener('DOMContentLoaded', function() {
        const chartDom = document.getElementById('familyTree');
        if (!chartDom) return; // å¦‚æœå®¹å™¨ä¸å­˜åœ¨åˆ™é€€å‡º

        const myChart = echarts.init(chartDom);

        // 1. æ¨¡æ‹Ÿä¸€ä¸ªå®¶åº­çš„é—ä¼ æ•°æ®
        const familyData = [
            { id: 'grandpa', name: 'ç¥–çˆ¶', gender: 'male', genotype: 'AA', description: 'å¥åº·ï¼Œéæºå¸¦è€…' },
            { id: 'grandma', name: 'ç¥–æ¯', gender: 'female', genotype: 'Aa', description: 'å¥åº·ï¼Œæºå¸¦è€…' },
            { id: 'father', name: 'çˆ¶äº²', gender: 'male', genotype: 'Aa', description: 'å¥åº·ï¼Œæºå¸¦è€…' },
            { id: 'mother', name: 'æ¯äº²', gender: 'female', genotype: 'Aa', description: 'å¥åº·ï¼Œæºå¸¦è€…' },
            { id: 'child', name: 'å­©å­', gender: 'male', genotype: 'aa', description: 'æ‚£ç—…ï¼ˆå¦‚ç™½åŒ–ç—…ï¼‰' }
        ];

        // 2. å®šä¹‰å®¶åº­æˆå‘˜å…³ç³»ï¼ˆè¿çº¿ï¼‰
        const links = [
            { source: 'grandpa', target: 'father' },
            { source: 'grandma', target: 'father' },
            { source: 'grandpa', target: 'mother' },
            { source: 'grandma', target: 'mother' },
            { source: 'father', target: 'child' },
            { source: 'mother', target: 'child' }
        ];

        // 3. å°†æ•°æ®è½¬æ¢ä¸ºEChartsèŠ‚ç‚¹æ ¼å¼ï¼Œå¹¶æ ¹æ®åŸºå› å‹è®¾ç½®é¢œè‰²å’Œå¤§å°
        const nodes = familyData.map(person => {
            let nodeStyle = { color: '#10B981' }; // é»˜è®¤ç»¿è‰²-å¥åº·
            let symbolSize = 40;

            if (person.genotype === 'Aa') {
                nodeStyle.color = '#FBBF24'; // é»„è‰²-æºå¸¦è€…
                symbolSize = 44;
            } else if (person.genotype === 'aa') {
                nodeStyle.color = '#EF4444'; // çº¢è‰²-æ‚£ç—…
                symbolSize = 48;
            }

            return {
                id: person.id,
                name: `${person.name}\n(${person.genotype})`, // èŠ‚ç‚¹æ˜¾ç¤ºçš„åç§°
                symbolSize: symbolSize,
                itemStyle: nodeStyle,
                // å°†åŸå§‹æ•°æ®æŒ‚è½½åˆ°èŠ‚ç‚¹ä¸Šï¼Œä¾¿äºç‚¹å‡»æ—¶è·å–
                personData: person
            };
        });

        // 4. EChartsé…ç½®é¡¹
        const option = {
            title: {
                text: 'æºå¸¦è€…çˆ¶æ¯ (Aa x Aa) çš„å®¶åº­',
                subtext: 'ç‚¹å‡»ä»»ä¸€æˆå‘˜æŸ¥çœ‹è¯¦æƒ…',
                left: 'center',
                textStyle: { fontSize: 14 }
            },
            tooltip: { // é¼ æ ‡æ‚¬åœæç¤ºæ¡†
                formatter: function(params) {
                    const p = params.data.personData;
                    return `<strong>${p.name}</strong><br/>åŸºå› å‹ï¼š${p.genotype}<br/>çŠ¶æ€ï¼š${p.description}`;
                }
            },
            series: [{
                type: 'graph',
                layout: 'force', // ä½¿ç”¨åŠ›å¼•å¯¼å¸ƒå±€ï¼Œè‡ªåŠ¨æ’åˆ—
                data: nodes,
                links: links,
                roam: true, // å…è®¸é¼ æ ‡ç¼©æ”¾å’Œæ‹–åŠ¨
                label: { // èŠ‚ç‚¹æ ‡ç­¾
                    show: true,
                    position: 'inside',
                    formatter: '{b}', // æ˜¾ç¤ºèŠ‚ç‚¹çš„ name å±æ€§
                    color: '#fff',
                    fontWeight: 'bold'
                },
                lineStyle: { // è¿çº¿æ ·å¼
                    width: 2,
                    color: '#ccc',
                    curveness: 0.1 // è½»å¾®çš„æ›²çº¿
                },
                force: { // åŠ›å¼•å¯¼å¸ƒå±€é…ç½®
                    repulsion: 200, // èŠ‚ç‚¹é—´æ–¥åŠ›
                    edgeLength: 100  // è¿çº¿é•¿åº¦
                },
                emphasis: { // é«˜äº®çŠ¶æ€
                    focus: 'adjacency',
                    lineStyle: {
                        width: 3
                    }
                }
            }]
        };

        // 5. åº”ç”¨é…ç½®å¹¶ç»˜åˆ¶å›¾è¡¨
        myChart.setOption(option);

        // 6. ç›‘å¬å›¾è¡¨ç‚¹å‡»äº‹ä»¶ï¼Œæ›´æ–°ä¸‹æ–¹ä¿¡æ¯æ¡†
        myChart.on('click', function(params) {
            if (params.dataType === 'node') {
                const p = params.data.personData;
                // æ›´æ–°å³ä¾§ä¿¡æ¯åŒºåŸŸ
                document.getElementById('selectedName').textContent = p.name;
                document.getElementById('selectedGenotype').textContent = p.genotype;
                document.getElementById('selectedDesc').textContent = p.description;

                // ã€å¯é€‰ã€‘é«˜çº§åŠŸèƒ½ï¼šç‚¹å‡»æ—¶å‘AIæé—®
                // å¯ä»¥åœ¨è¿™é‡Œè§¦å‘ä¸€ä¸ªå‡½æ•°ï¼Œè‡ªåŠ¨å‘å³ä¾§çš„AIåŠ©æ‰‹å‘é€ä¸€æ¡æ¶ˆæ¯
                // ä¾‹å¦‚ï¼šsendQuestionToAI(`è¯·è§£é‡Šä¸€ä¸‹åŸºå› å‹ ${p.genotype} çš„å«ä¹‰ã€‚`);
            }
        });

        // 7. å½“æµè§ˆå™¨çª—å£å¤§å°æ”¹å˜æ—¶ï¼Œé‡ç½®å›¾è¡¨å¤§å°
        window.addEventListener('resize', function() {
            myChart.resize();
        });
    });

    // é¡µé¢åŠ è½½åæ‰§è¡Œ
    document.addEventListener('DOMContentLoaded', loadChatFrame);
</script>
</body>
</html>