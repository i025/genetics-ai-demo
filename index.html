<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIé—ä¼ ç—…å¾®è¯¾æ¼”ç¤º - å¸¸æŸ“è‰²ä½“éšæ€§é—ä¼ </title>
    <!-- å¼•å…¥EChartså›¾è¡¨åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        /* å…¨å±€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        /* å¤´éƒ¨æ ·å¼ */
        header {
            background: linear-gradient(135deg, #4F46E5 0%, #7E69AB 100%);
            color: white;
            padding: 35px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "ğŸ§¬";
            position: absolute;
            font-size: 120px;
            opacity: 0.1;
            top: 10px;
            right: 40px;
        }
        
        header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .main-content {
            display: flex;
            flex-wrap: wrap;
            min-height: 700px;
        }
        
        /* å·¦ä¾§å¾®è¯¾è®²è§£åŒº */
        .lesson-panel {
            flex: 1;
            min-width: 350px;
            padding: 35px;
            border-right: 1px solid #eaeaea;
            background: #fdfdfd;
        }
        
        .lesson-panel h2 {
            color: #4F46E5;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #f0f0f0;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .lesson-panel h2::before {
            content: "ğŸ“š";
            font-size: 1.5rem;
        }
        
        /* é—ä¼ å›¾è°±åŒºåŸŸ */
        .chart-panel {
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
            border-radius: 15px;
            border: 2px solid #e6eeff;
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.05);
        }
        
        .chart-panel h3 {
            color: #4F46E5;
            margin-bottom: 15px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-panel h3::before {
            content: "ğŸ§¬";
        }
        
        #familyTree {
            width: 100%;
            height: 320px;
            margin-top: 15px;
            border-radius: 10px;
            background: white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .info-box {
            margin-top: 25px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            border-left: 5px solid #4F46E5;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .info-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(0,0,0,0.08);
        }
        
        .info-box p {
            margin-bottom: 10px;
            font-size: 1.05rem;
        }
        
        .info-box strong {
            color: #4F46E5;
        }
        
        /* æ¦‚å¿µæ¡†æ ·å¼ */
        .concept-box {
            background: linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%);
            padding: 25px;
            border-radius: 15px;
            margin-top: 25px;
            border-left: 5px solid #4F46E5;
            box-shadow: 0 5px 15px rgba(0,0,0,0.03);
            transition: all 0.3s ease;
        }
        
        .concept-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.06);
        }
        
        .concept-box h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .concept-box h3::before {
            content: "â­";
        }
        
        .concept-box ul {
            margin-left: 25px;
            margin-top: 15px;
        }
        
        .concept-box li {
            margin-bottom: 12px;
            padding-left: 5px;
            font-size: 1.05rem;
        }
        
        .genotype-example {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .genotype-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .healthy { background-color: #10B981; }
        .carrier { background-color: #F59E0B; }
        .affected { background-color: #EF4444; }
        
        /* å³ä¾§AIå¯¹è¯åŒº */
        .ai-panel {
            flex: 1;
            min-width: 350px;
            padding: 35px;
            display: flex;
            flex-direction: column;
            background: #fdfdfd;
        }
        
        .ai-panel h2 {
            color: #10B981;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #f0f0f0;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ai-panel h2::before {
            content: "ğŸ¤–";
            font-size: 1.5rem;
        }
        
        /* èŠå¤©å®¹å™¨æ ·å¼ */
        #chat-container {
            flex: 1;
            border: 2px solid #e5e7eb;
            border-radius: 15px;
            overflow-y: auto;
            padding: 20px;
            margin-bottom: 25px;
            background: #f9fafb;
            min-height: 420px;
            max-height: 500px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        /* æ¶ˆæ¯æ ·å¼ */
        .message {
            max-width: 85%;
            padding: 15px 20px;
            border-radius: 18px;
            line-height: 1.5;
            font-size: 1.05rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background: linear-gradient(135deg, #4F46E5 0%, #7E69AB 100%);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        
        .bot-message {
            background: linear-gradient(135deg, #e0e7ff 0%, #f3f4f6 100%);
            color: #1f2937;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
            border: 1px solid #e5e7eb;
        }
        
        .message strong {
            font-weight: 600;
            margin-right: 5px;
        }
        
        /* è¾“å…¥åŒºåŸŸæ ·å¼ */
        .input-area {
            display: flex;
            gap: 12px;
            margin-top: auto;
        }
        
        #user-input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid #d1d5db;
            border-radius: 12px;
            font-size: 1.05rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        #user-input:focus {
            outline: none;
            border-color: #4F46E5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        #user-input::placeholder {
            color: #9ca3af;
        }
        
        #send-button {
            padding: 16px 32px;
            background: linear-gradient(135deg, #10B981 0%, #0da271 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.05rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }
        
        #send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(16, 185, 129, 0.3);
        }
        
        #send-button:active {
            transform: translateY(0);
        }
        
        #send-button:disabled {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* APIä¿¡æ¯æç¤º */
        .api-info {
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #fef3c7 0%, #fef9c3 100%);
            border-radius: 12px;
            border-left: 4px solid #F59E0B;
            font-size: 0.9rem;
            color: #92400e;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .api-info::before {
            content: "ğŸ’¡";
            font-size: 1.2rem;
        }
        
        /* é¡µè„šæ ·å¼ */
        footer {
            text-align: center;
            padding: 25px;
            color: #666;
            font-size: 0.95rem;
            border-top: 1px solid #eee;
            background: #f9fafb;
        }
        
        footer p {
            margin-bottom: 5px;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1100px) {
            .main-content {
                flex-direction: column;
            }
            
            .lesson-panel, .ai-panel {
                border-right: none;
                border-bottom: 1px solid #eaeaea;
            }
        }
        
        @media (max-width: 768px) {
            header h1 {
                font-size: 2.2rem;
            }
            
            header p {
                font-size: 1rem;
            }
            
            .lesson-panel, .ai-panel {
                padding: 25px;
            }
            
            #familyTree {
                height: 280px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§¬ åŸºå› é—ä¼ ç—…AIå¾®è¯¾æ¼”ç¤º</h1>
            <p>æ¢ç´¢å¸¸æŸ“è‰²ä½“éšæ€§é—ä¼ çš„å¥¥ç§˜ | äº¤äº’å¼å›¾è°± + AIå¯¼å¸ˆç­”ç–‘</p>
        </header>

        <div class="main-content">
            <section class="lesson-panel">
                <h2>æ ¸å¿ƒæ¦‚å¿µï¼šå¸¸æŸ“è‰²ä½“éšæ€§é—ä¼ </h2>
                <p style="margin-bottom: 20px; font-size: 1.1rem; color: #555;">æœ¬å¾®è¯¾å°†å¸®åŠ©ä½ ç†è§£ä¸€ç±»é‡è¦çš„é—ä¼ ç—…ä¼ é€’è§„å¾‹ï¼Œç»“åˆäº¤äº’å›¾è°±å’ŒAIå¯¼å¸ˆï¼Œæ·±å…¥å­¦ä¹ é—ä¼ å­¦åŸç†ã€‚</p>
                
                <div class="chart-panel">
                    <h3>é—ä¼ ç³»è°±å›¾æ¨¡æ‹Ÿ</h3>
                    <p>ç‚¹å‡»å›¾ä¸­çš„å®¶åº­æˆå‘˜ï¼ŒæŸ¥çœ‹å…¶é—ä¼ ä¿¡æ¯ï¼š</p>
                    <!-- EChartså›¾è¡¨å®¹å™¨ -->
                    <div id="familyTree"></div>
                    <!-- ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
                    <div id="memberInfo" class="info-box">
                        <p><strong>å½“å‰é€‰ä¸­ï¼š</strong> <span id="selectedName">æš‚æ— </span></p>
                        <p><strong>åŸºå› å‹ï¼š</strong> <span id="selectedGenotype">-</span></p>
                        <p><strong>è¯´æ˜ï¼š</strong> <span id="selectedDesc">è¯·ç‚¹å‡»ä¸Šæ–¹å›¾è°±ä¸­çš„æˆå‘˜</span></p>
                    </div>
                </div>

                <div class="concept-box">
                    <h3>æ ¸å¿ƒç‰¹ç‚¹</h3>
                    <ul>
                        <li><strong>åŸºå› ä½ç½®</strong>ï¼šè‡´ç—…åŸºå› ä½äº<strong>å¸¸æŸ“è‰²ä½“</strong>ï¼ˆéæ€§æŸ“è‰²ä½“ï¼‰ä¸Šã€‚</li>
                        <li><strong>å‘ç—…æ¡ä»¶</strong>ï¼šåªæœ‰å½“ä¸ªä½“çš„ä¸€å¯¹ç­‰ä½åŸºå› éƒ½æ˜¯<strong>éšæ€§è‡´ç—…åŸºå› ï¼ˆaaï¼‰</strong>æ—¶æ‰ä¼šæ‚£ç—…ã€‚</li>
                        <li><strong>å…³é”®è§’è‰²</strong>ï¼šæºå¸¦ä¸€ä¸ªéšæ€§è‡´ç—…åŸºå› çš„<strong>æ‚åˆå­ï¼ˆAaï¼‰</strong>ç§°ä¸º<strong>æºå¸¦è€…</strong>ï¼Œä»–ä»¬æœ¬èº«å¥åº·ï¼Œä½†å¯èƒ½å°†è‡´ç—…åŸºå› ä¼ ç»™åä»£ã€‚</li>
                    </ul>
                </div>

                <div class="concept-box">
                    <h3>ç»å…¸é—ä¼ è§„å¾‹</h3>
                    <p>å½“<strong>ä¸¤ä½æºå¸¦è€…ï¼ˆAaï¼‰</strong>ç»“å©šæ—¶ï¼Œåä»£çš„åŸºå› å‹æ¦‚ç‡åˆ†å¸ƒå¦‚ä¸‹ï¼š</p>
                    
                    <div class="genotype-example">
                        <div class="genotype-color healthy"></div>
                        <span><strong>å¥åº· (AA)</strong>ï¼šæ¦‚ç‡ 25%</span>
                    </div>
                    
                    <div class="genotype-example">
                        <div class="genotype-color carrier"></div>
                        <span><strong>å¥åº·æºå¸¦è€… (Aa)</strong>ï¼šæ¦‚ç‡ 50%</span>
                    </div>
                    
                    <div class="genotype-example">
                        <div class="genotype-color affected"></div>
                        <span><strong>æ‚£ç—… (aa)</strong>ï¼šæ¦‚ç‡ 25%</span>
                    </div>
                    
                    <p style="margin-top:20px; font-style:italic; color: #4F46E5;">ğŸ‘‰ è¿™å°±æ˜¯"çˆ¶æ¯å¥åº·ï¼Œå­©å­å´å¯èƒ½æ‚£ç—…"çš„é—ä¼ å­¦åŸç†ã€‚</p>
                </div>

                <div class="concept-box">
                    <h3>å­¦ä¹ ç›®æ ‡</h3>
                    <p>ç†è§£ä¸Šè¿°è§„å¾‹åï¼Œä½ å¯ä»¥å°è¯•å‘å³ä¾§çš„AIå¯¼å¸ˆæé—®ï¼Œä¾‹å¦‚ï¼š</p>
                    <ul>
                        <li>"å¦‚æœæˆ‘æ˜¯æºå¸¦è€…ï¼Œæˆ‘çš„å­©å­ä¸€å®šä¼šæ‚£ç—…å—ï¼Ÿ"</li>
                        <li>"è¿‘äº²ç»“å©šä¸ºä»€ä¹ˆä¼šæé«˜é—ä¼ ç—…é£é™©ï¼Ÿ"</li>
                        <li>"ç™½åŒ–ç—…çš„é—ä¼ æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ"</li>
                    </ul>
                </div>
            </section>

            <section class="ai-panel">
                <h2>ğŸ¤– å¯¹è¯AIå¯¼å¸ˆ</h2>
                <p>æˆ‘æ˜¯ä½ çš„ä¸“å±AIç”Ÿç‰©è€å¸ˆ<strong>â€œåŸºå› åšå£«â€</strong>ã€‚å…³äºé—ä¼ ç—…çš„ä»»ä½•ç–‘é—®ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å³å¯ä¸æˆ‘è¿›è¡Œå®Œæ•´å¯¹è¯ï¼š</p>
                
                <!-- æ ¸å¿ƒï¼šè·³è½¬æŒ‰é’®ä¸è¯´æ˜ -->
                <div class="chat-redirect-box">
                    <a href="https://www.coze.cn/store/agent/7599549366093430836" 
                    target="_blank" 
                    class="coze-chat-button"
                    onclick="trackAIClick()">
                        ğŸ§¬ ç‚¹å‡»è¿™é‡Œï¼Œå¼€å¯AIç­”ç–‘ â†’
                    </a>
                    <p class="redirect-tip">ï¼ˆå°†åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€â€œé—ä¼ ç—…å°å¯¼å¸ˆâ€ä¸“å±å¯¹è¯ç•Œé¢ï¼‰</p>
                    <div class="feature-list">
                        <p><strong>ğŸ’¡ åŠŸèƒ½å®Œæ•´ï¼Œæ‚¨å¯ä»¥ï¼š</strong></p>
                        <ul>
                            <li>å‘â€œåŸºå› åšå£«â€è‡ªç”±æé—®</li>
                            <li>æŸ¥çœ‹å®Œæ•´çš„å¯¹è¯å†å²</li>
                            <li>ä½“éªŒæµç•…çš„AIäº¤äº’</li>
                        </ul>
                    </div>
                </div>

                <!-- æœ¬åœ°äº’åŠ¨ç¤ºä¾‹ï¼ˆä¿ç•™è¶£å‘³æ€§ï¼‰ -->
                <div class="local-demo">
                    <h4>ğŸ§ª æœ¬åœ°äº’åŠ¨æ€è€ƒé¢˜</h4>
                    <p><strong>é—®é¢˜ï¼š</strong>å¦‚æœçˆ¶æ¯éƒ½æ˜¯æºå¸¦è€… (Aa)ï¼Œä»–ä»¬ç”Ÿä¸‹å¥åº·å­©å­ (AA) çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ</p>
                    <div class="answer-area">
                        <button onclick="showAnswer(this)">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆä¸è§£æ</button>
                        <p class="answer" style="display: none; margin-top: 10px; padding: 10px; background: #e0f2fe; border-radius: 5px;">
                            <strong>ç­”æ¡ˆï¼š25%</strong><br>
                            <strong>è§£æï¼š</strong>æ ¹æ®å­Ÿå¾·å°”é—ä¼ è§„å¾‹ï¼ŒAa x Aa çš„åä»£åŸºå› å‹æ¯”ä¾‹ä¸ºï¼šAA(25%)ï¼ŒAa(50%)ï¼Œaa(25%)ã€‚å…¶ä¸­ï¼ŒAA åŸºå› å‹è¡¨ç°ä¸ºå¥åº·ä¸”éæºå¸¦è€…ã€‚
                        </p>
                    </div>
                </div>
            </section>

            <script>
                // ç®€å•çš„æœ¬åœ°äº’åŠ¨å‡½æ•°
                function showAnswer(buttonElement) {
                    const answerEl = buttonElement.nextElementSibling;
                    answerEl.style.display = answerEl.style.display === 'block' ? 'none' : 'block';
                    buttonElement.textContent = answerEl.style.display === 'block' ? 'æ”¶èµ·è§£æ' : 'ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆä¸è§£æ';
                }
                
                // å¯é€‰çš„ç‚¹å‡»ç»Ÿè®¡ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
                function trackAIClick() {
                    console.log('ç”¨æˆ·ç‚¹å‡»äº†AIå¯¹è¯æŒ‰é’®ï¼Œå‰å¾€Cozeå•†åº—é¡µã€‚');
                    // è¿™é‡Œå¯ä»¥æ·»åŠ ç®€å•çš„è®¿é—®ç»Ÿè®¡ï¼Œä¾‹å¦‚ï¼š
                    // if (typeof gtag !== 'undefined') gtag('event', 'click_ai_button');
                }
            </script>

            <style>
                /* ä¸ºè·³è½¬åŒºåŸŸæ·»åŠ æ–°æ ·å¼ */
                .chat-redirect-box {
                    text-align: center;
                    margin: 30px 0;
                    padding: 30px;
                    background: linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%);
                    border-radius: 16px;
                    border: 2px solid #bae6fd;
                    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
                }
                
                .coze-chat-button {
                    display: inline-block;
                    background: linear-gradient(135deg, #10B981 0%, #0da271 100%);
                    color: white;
                    padding: 18px 40px;
                    font-size: 1.2rem;
                    border-radius: 50px;
                    text-decoration: none;
                    font-weight: bold;
                    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
                    transition: all 0.3s ease;
                    margin-bottom: 15px;
                }
                
                .coze-chat-button:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 12px 25px rgba(16, 185, 129, 0.4);
                    background: linear-gradient(135deg, #0da271 0%, #0a8f62 100%);
                }
                
                .redirect-tip {
                    color: #666;
                    font-size: 0.95rem;
                    margin-bottom: 20px;
                }
                
                .feature-list {
                    text-align: left;
                    display: inline-block;
                    background: white;
                    padding: 15px 25px;
                    border-radius: 10px;
                    border-left: 4px solid #10B981;
                    margin-top: 15px;
                }
                
                .feature-list ul {
                    margin-left: 20px;
                    margin-top: 8px;
                    color: #555;
                }
                
                .feature-list li {
                    margin-bottom: 5px;
                }
                
                .local-demo {
                    margin-top: 30px;
                    padding: 20px;
                    background-color: #f8fafc;
                    border-radius: 12px;
                    border: 1px solid #e2e8f0;
                }
                
                .local-demo h4 {
                    color: #4F46E5;
                    margin-bottom: 15px;
                }
                
                .local-demo button {
                    background-color: #4F46E5;
                    color: white;
                    padding: 10px 20px;
                    border: none;
                    border-radius: 8px;
                    cursor: pointer;
                    font-weight: bold;
                    transition: background-color 0.2s;
                }
                
                .local-demo button:hover {
                    background-color: #4338ca;
                }
            </style>
        </div>

        <footer>
            <p>è®¡ç®—æœºè®¾è®¡å¤§èµ› Â· AIå¾®è¯¾ä¸æ•™å­¦è¾…åŠ©èµ›é“ Demo</p>
            <p>æœ¬é¡µé¢ä»…ç”¨äºå­¦ä¹ æ¼”ç¤º | äº¤äº’å¼é—ä¼ å­¦æ•™å­¦å·¥å…·</p>
        </footer>
    </div>

    <script>
    // ========== APIé…ç½®åŒºï¼šå¿…é¡»ä¿®æ”¹ï¼==========
    // è¯·æ›¿æ¢ä»¥ä¸‹å€¼ä¸ºä½ è‡ªå·±çš„Coze APIé…ç½®
    const API_KEY = 'pat_Y8l3wUXFysiTJjMejTDaXibPhdCXO9MWrqwFmavr6jnBtAIb1icHp8RqhWnii5Rh'; // æ›¿æ¢ï¼šä½ çš„Cozeä¸ªäººè®¿é—®ä»¤ç‰Œ
    const BOT_ID = '7599549366093430836'; // ä½ çš„Bot ID
    const CONVERSATION_ID = 'genetics_demo_conversation'; // è‡ªå®šä¹‰ä¼šè¯ID
    const USER_ID = 'demo_student_001'; // è‡ªå®šä¹‰ç”¨æˆ·ID
    // =========================================

    // ========== äº¤äº’å¼é—ä¼ å›¾è°±ä»£ç  ==========
    document.addEventListener('DOMContentLoaded', function() {
        const chartDom = document.getElementById('familyTree');
        if (!chartDom) return;

        const myChart = echarts.init(chartDom);

        // 1. æ¨¡æ‹Ÿä¸€ä¸ªå®¶åº­çš„é—ä¼ æ•°æ®
        const familyData = [
            { id: 'grandpa', name: 'ç¥–çˆ¶', gender: 'male', genotype: 'AA', description: 'å¥åº·ï¼Œéæºå¸¦è€…' },
            { id: 'grandma', name: 'ç¥–æ¯', gender: 'female', genotype: 'Aa', description: 'å¥åº·ï¼Œæºå¸¦è€…' },
            { id: 'father', name: 'çˆ¶äº²', gender: 'male', genotype: 'Aa', description: 'å¥åº·ï¼Œæºå¸¦è€…' },
            { id: 'mother', name: 'æ¯äº²', gender: 'female', genotype: 'Aa', description: 'å¥åº·ï¼Œæºå¸¦è€…' },
            { id: 'child', name: 'å­©å­', gender: 'male', genotype: 'aa', description: 'æ‚£ç—…ï¼ˆå¦‚ç™½åŒ–ç—…ï¼‰' }
        ];

        // 2. å®šä¹‰å®¶åº­æˆå‘˜å…³ç³»ï¼ˆè¿çº¿ï¼‰
        const links = [
            { source: 'grandpa', target: 'father' },
            { source: 'grandma', target: 'father' },
            { source: 'grandpa', target: 'mother' },
            { source: 'grandma', target: 'mother' },
            { source: 'father', target: 'child' },
            { source: 'mother', target: 'child' }
        ];

        // 3. å°†æ•°æ®è½¬æ¢ä¸ºEChartsèŠ‚ç‚¹æ ¼å¼ï¼Œå¹¶æ ¹æ®åŸºå› å‹è®¾ç½®é¢œè‰²å’Œå¤§å°
        const nodes = familyData.map(person => {
            let nodeStyle = { 
                color: '#10B981',
                borderColor: '#0da271',
                borderWidth: 2
            };
            let symbolSize = 50;

            if (person.genotype === 'Aa') {
                nodeStyle.color = '#F59E0B';
                nodeStyle.borderColor = '#d97706';
                symbolSize = 55;
            } else if (person.genotype === 'aa') {
                nodeStyle.color = '#EF4444';
                nodeStyle.borderColor = '#dc2626';
                symbolSize = 60;
            }

            return {
                id: person.id,
                name: `${person.name}\n(${person.genotype})`,
                symbolSize: symbolSize,
                itemStyle: nodeStyle,
                label: {
                    color: '#fff',
                    fontWeight: 'bold',
                    fontSize: 14
                },
                personData: person
            };
        });

        // 4. EChartsé…ç½®é¡¹
        const option = {
            title: {
                text: 'æºå¸¦è€…çˆ¶æ¯ (Aa Ã— Aa) çš„å®¶åº­é—ä¼ ç³»è°±',
                subtext: 'ç‚¹å‡»ä»»ä¸€æˆå‘˜æŸ¥çœ‹é—ä¼ ä¿¡æ¯',
                left: 'center',
                textStyle: { 
                    fontSize: 16,
                    color: '#4F46E5'
                },
                subtextStyle: {
                    fontSize: 13,
                    color: '#6b7280'
                }
            },
            tooltip: {
                backgroundColor: 'rgba(255, 255, 255, 0.95)',
                borderColor: '#4F46E5',
                borderWidth: 1,
                textStyle: { color: '#333' },
                formatter: function(params) {
                    const p = params.data.personData;
                    return `
                    <div style="padding: 5px;">
                        <strong style="color: #4F46E5;">${p.name}</strong><br/>
                        åŸºå› å‹ï¼š<strong>${p.genotype}</strong><br/>
                        çŠ¶æ€ï¼š${p.description}
                    </div>`;
                }
            },
            series: [{
                type: 'graph',
                layout: 'force',
                data: nodes,
                links: links,
                roam: true,
                label: {
                    show: true,
                    position: 'inside',
                    formatter: '{b}',
                    color: '#fff',
                    fontWeight: 'bold',
                    fontSize: 12
                },
                lineStyle: {
                    width: 3,
                    color: '#9ca3af',
                    curveness: 0.2
                },
                force: {
                    repulsion: 250,
                    edgeLength: 120,
                    gravity: 0.1
                },
                emphasis: {
                    focus: 'adjacency',
                    lineStyle: {
                        width: 4,
                        color: '#4F46E5'
                    },
                    itemStyle: {
                        shadowBlur: 10,
                        shadowColor: 'rgba(0, 0, 0, 0.3)'
                    }
                }
            }]
        };

        // 5. åº”ç”¨é…ç½®å¹¶ç»˜åˆ¶å›¾è¡¨
        myChart.setOption(option);

        // 6. ç›‘å¬å›¾è¡¨ç‚¹å‡»äº‹ä»¶ï¼Œæ›´æ–°ä¸‹æ–¹ä¿¡æ¯æ¡†
        myChart.on('click', function(params) {
            if (params.dataType === 'node') {
                const p = params.data.personData;
                document.getElementById('selectedName').textContent = p.name;
                document.getElementById('selectedGenotype').textContent = p.genotype;
                document.getElementById('selectedDesc').textContent = p.description;
                
                // é«˜äº®æ˜¾ç¤ºå½“å‰é€‰ä¸­çš„èŠ‚ç‚¹
                myChart.dispatchAction({
                    type: 'highlight',
                    seriesIndex: 0,
                    dataIndex: params.dataIndex
                });
            }
        });

        // 7. å“åº”æµè§ˆå™¨çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', function() {
            myChart.resize();
        });
        
        // 8. åˆå§‹åŒ–APIèŠå¤©åŠŸèƒ½
        initChat();
    });

    // ========== APIèŠå¤©åŠŸèƒ½ä»£ç  ==========
    function initChat() {
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        
        // æŒ‰Enteré”®å‘é€æ¶ˆæ¯
        userInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });
        
        // åˆå§‹ç„¦ç‚¹åœ¨è¾“å…¥æ¡†
        userInput.focus();
    }
    
    // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©å®¹å™¨
    function addMessage(content, isUser = false) {
        const container = document.getElementById('chat-container');
        const messageDiv = document.createElement('div');
        messageDiv.className = isUser ? 'message user-message' : 'message bot-message';
        messageDiv.innerHTML = `<strong>${isUser ? 'ä½ ï¼š' : 'åŸºå› åšå£«ï¼š'}</strong> ${content}`;
        container.appendChild(messageDiv);
        container.scrollTop = container.scrollHeight; // æ»šåŠ¨åˆ°åº•éƒ¨
    }
    
    // å‘é€æ¶ˆæ¯åˆ°Coze API
    async function sendMessage() {
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const userText = userInput.value.trim();
        
        if (!userText) {
            userInput.focus();
            return;
        }
        
        // 1. æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
        addMessage(userText, true);
        userInput.value = '';
        userInput.disabled = true;
        sendButton.disabled = true;
        sendButton.textContent = 'å‘é€ä¸­...';
        
        // 2. æ˜¾ç¤º"æ€è€ƒä¸­"æç¤º
        const thinkingId = 'thinking-' + Date.now();
        const container = document.getElementById('chat-container');
        const thinkingDiv = document.createElement('div');
        thinkingDiv.id = thinkingId;
        thinkingDiv.className = 'message bot-message';
        thinkingDiv.innerHTML = '<strong>åŸºå› åšå£«ï¼š</strong> <em style="color: #6b7280;">æ­£åœ¨æ€è€ƒ...</em>';
        container.appendChild(thinkingDiv);
        container.scrollTop = container.scrollHeight;
        
        try {
            // 3. å‡†å¤‡APIè¯·æ±‚
            const response = await fetch('https://api.coze.cn/v1/chat', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${API_KEY}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({
                    bot_id: BOT_ID,
                    conversation_id: CONVERSATION_ID,
                    user_id: USER_ID,
                    query: userText,
                    auto_save_history: true,
                    stream: false
                })
            });
            
            // 4. å¤„ç†å“åº”
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`APIè¯·æ±‚å¤±è´¥ (${response.status}): ${errorText}`);
            }
            
            const data = await response.json();
            const answer = data.messages?.[0]?.content || 'æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰ç†è§£è¿™ä¸ªé—®é¢˜ã€‚è¯·æ¢ä¸€ç§æ–¹å¼æé—®ã€‚';
            
            // 5. ç§»é™¤"æ€è€ƒä¸­"ï¼Œæ˜¾ç¤ºAIå›å¤
            document.getElementById(thinkingId).remove();
            addMessage(answer);
            
        } catch (error) {
            console.error('è°ƒç”¨Coze APIå‡ºé”™:', error);
            document.getElementById(thinkingId).remove();
            
            // æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯
            let errorMessage = 'æŠ±æ­‰ï¼Œæš‚æ—¶æ— æ³•è¿æ¥åˆ°AIæœåŠ¡ã€‚è¯·ç¨åå†è¯•ã€‚';
            if (error.message.includes('401')) {
                errorMessage = 'APIå¯†é’¥é”™è¯¯æˆ–å·²è¿‡æœŸï¼Œè¯·æ£€æŸ¥é…ç½®ã€‚';
            } else if (error.message.includes('404')) {
                errorMessage = 'æœªæ‰¾åˆ°æ™ºèƒ½ä½“ï¼Œè¯·æ£€æŸ¥Bot IDé…ç½®ã€‚';
            } else if (error.message.includes('network') || error.message.includes('Failed to fetch')) {
                errorMessage = 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®åé‡è¯•ã€‚';
            } else if (error.message.includes('429')) {
                errorMessage = 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•ã€‚';
            }
            
            addMessage(`<span style="color: #dc2626;">${errorMessage}</span>`);
        } finally {
            // 6. æ¢å¤è¾“å…¥æ¡†å’ŒæŒ‰é’®çŠ¶æ€
            userInput.disabled = false;
            sendButton.disabled = false;
            sendButton.textContent = 'å‘é€';
            userInput.focus();
        }
    }
    
    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œçš„åˆå§‹åŒ–
    window.addEventListener('DOMContentLoaded', function() {
        console.log('AIé—ä¼ ç—…å¾®è¯¾æ¼”ç¤ºé¡µé¢åŠ è½½å®Œæˆ');
        console.log('é…ç½®ä¿¡æ¯:', { BOT_ID, CONVERSATION_ID, USER_ID });
        
        // æ·»åŠ ä¸€ä¸ªç¤ºä¾‹é—®é¢˜æŒ‰é’®ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰
        const chatContainer = document.getElementById('chat-container');
        const exampleBtn = document.createElement('button');
        exampleBtn.textContent = 'è¯•è¯•é—®ï¼š"ä»€ä¹ˆæ˜¯æºå¸¦è€…ï¼Ÿ"';
        exampleBtn.style.cssText = `
            align-self: center;
            margin-top: 10px;
            padding: 8px 16px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            color: #4F46E5;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        `;
        exampleBtn.onmouseover = () => exampleBtn.style.background = '#e5e7eb';
        exampleBtn.onmouseout = () => exampleBtn.style.background = '#f3f4f6';
        exampleBtn.onclick = () => {
            document.getElementById('user-input').value = 'ä»€ä¹ˆæ˜¯æºå¸¦è€…ï¼Ÿ';
            sendMessage();
        };
        
        // å¯ä»¥å°†ç¤ºä¾‹æŒ‰é’®æ·»åŠ åˆ°é¡µé¢ï¼Œè¿™é‡Œæš‚æ—¶æ³¨é‡Šæ‰
        // chatContainer.parentNode.insertBefore(exampleBtn, chatContainer.nextSibling);
    });
    </script>
</body>
</html>